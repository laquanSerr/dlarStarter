<!DOCTYPE html>
<html>
<head>
    <title>All Contracts</title>
</head>
<body> <!-- Moved the body tag up -->
    <h2>All Contracts</h2>

    {% for contract in contracts %}
    <div>
        <p>{{ contract.dad_text }}</p>

        {% if contract.status == 'draft' and role == 'PartyB' %}
            <a href="/edit/{{ contract.id }}">Edit</a>
        {% endif %}

        {% if contract.status != 'completed' and role == 'PartyA' %}
            <a href="/approve/{{ contract.id }}">Approve</a>
        {% endif %}
    </div>
    {% endfor %}

    <h2>Submitted Contracts</h2>
    <ul>
        {% for contract in contracts %}
            <li>
                ID: {{ contract.id }} | Created by: {{ contract.created_by }} |
                <a href="/summary/{{ contract.id }}">View Summary</a>
            </li>
        {% else %}
            <li>No contracts found.</li>
        {% endfor %}
    </ul>

    <ul id="contract-list"></ul>
    <script>
        fetch("/contracts")
          .then(res => res.json())
          .then(data => {
            const list = document.getElementById("contract-list");
            list.innerHTML = "";

            if (data.length === 0) {
              list.innerHTML = "<li>No contracts found.</li>";
            } else {
              data.forEach(contract => {
                const li = document.createElement("li");
                li.textContent = `Created by ${contract.created_by} â†’ ${contract.for_party}: ${contract.dad_text}`;
                list.appendChild(li);
              });
            }
          })
          .catch(error => console.error("Error fetching contracts:", error)); <!-- Added error handling -->
    </script>

</body>
</html>
